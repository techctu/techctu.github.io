<!DOCTYPE HTML>
<!--
	Future Imperfect by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
  <head>
  <title>Avalon</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<!--[if lte IE 8]><script src="js/ie/html5shiv.js"></script><![endif]-->
	<link rel="stylesheet" href="/css/main.css" />
	<link rel="stylesheet" href="/css/pygments.css">
	<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
	<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
</head>

	<body>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
<header id="header">
  <h1><a href="http://techctu.github.io/">Avalon</a></h1>
	<nav class="links">
    <!--
    <ul>
      <li><a href="#">Lorem</a></li>
			<li><a href="#">Ipsum</a></li>
			<li><a href="#">Feugiat</a></li>
			<li><a href="#">Tempus</a></li>
			<li><a href="#">Adipiscing</a></li>
		</ul>
  -->
	</nav>
	<nav class="main">
    <ul>
                <!--
								<li class="search">
									<a class="fa-search" href="#search">Search</a>
									<form id="search" method="get" action="#">
										<input type="text" name="query" placeholder="Search" />
									</form>
								</li>
              -->
		  <li class="menu">
		  	<a class="fa-bars" href="#menu">Menu</a>
			</li>
		</ul>
	</nav>
</header>

<!-- Menu -->
<section id="menu">
  <!-- Search -->
  <!--
  <section>
	  <form class="search" method="get" action="#">
	    <input type="text" name="query" placeholder="Search" />
		</form>
	</section>
  -->
	<!-- Links -->
	<section>
	  <ul class="links">
	    <li>
		    <a href="/acknowledgement">
				  <h3>Acknowledgement</h3>
				  <p>Acknowledgement</p>
				</a>
			</li>
    </ul>
	</section>
	<!-- Actions -->
  <!--
  <section>
	  <ul class="actions vertical">
	    <li><a href="#" class="button big fit">Log In</a></li>
    </ul>
  </section>
  -->
</section>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
            <article class="post">
              <header>
                <div class="title">
                  <h2><a href="/2016/06/06/react%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97.html">React开发入门指南</a></h2>
                <!-- <p>Lorem ipsum dolor amet nullam consequat etiam feugiat</p> -->
                </div>
                <div class="meta">
                  <time class="published" datetime="2016-06-06">June 06, 2016</time>
                  

        <!--
        <a href="#" class="author"><span class="name">Jane Doe</span><img src="images/avatar.jpg" alt="" /></a>
        -->
                </div>
              </header>
              
              <p><em>用Jekyll和Markdown写的，使用的pygment的代码高亮没有调整，react相关代码会出现红框，无视就好，懒癌发作暂时不想研究。</em></p>

<p><em>代码是示例，仅作为参考。</em></p>

<p><em>不知不觉写了很多东西，有点杂，见谅。</em></p>

<h1 id="reacthttpfacebookgithubioreactdocsgetting-startedhtml"><a href="http://facebook.github.io/react/docs/getting-started.html">React</a>是什么</h1>
<p>React是基于JavaScript的，状态驱动的，操作虚拟DOM的UI框架。使用该框架有很多好处，对我来说，核心是将对DOM的操作隔离开，让开发人员专注于业务流程和状态。</p>

<h2 id="section">与传统开发比较</h2>
<p>在传统的前端页面开发中，我们一般会给一个标签设置一个id或是类似的东西，以便对其进行操作，如：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s1">&#39;id_xxx&#39;</span><span class="o">&gt;</span><span class="err">这是一个标签</span><span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="c1">// 纯JS</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementByID</span><span class="p">(</span><span class="s1">&#39;id_xxx&#39;</span><span class="p">)</span>

    <span class="c1">// JQuery</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#id_xxx&#39;</span><span class="p">)</span>

    <span class="c1">// 再去操作</span></code></pre></figure>

<p>而在React中，一般这么做：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// import省略</span>
<span class="c1">// 为了比较完整展现一下结构，比上面偷懒写的代码多了很多</span>
<span class="kr">class</span> <span class="nx">ComponentA</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">stateTag</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">render</span><span class="p">(){</span>
        <span class="c1">// 进行一些预处理操作</span>
        <span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">stateTag</span><span class="o">?</span> <span class="s1">&#39;这是一个标签&#39;</span><span class="o">:</span><span class="s1">&#39;这不是一个标签&#39;</span>
        <span class="kd">let</span> <span class="nx">arrayInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">elems</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nx">arrayInfo</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">v</span><span class="p">,</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">elems</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">i</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">}</span> <span class="o">&lt;</span><span class="err">/div&gt;)))</span>
        <span class="k">return</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">elems</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;&lt;/div&gt;)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>这样我们只需要关注什么样的场景下需要进行title值的修改，不需要关注ID之类的维护亦或一些复杂繁琐的DOM操作。想象一下如果是一个复杂的多级下拉选择框，选完了之后对应的列表需要进行自动更新。</p>

<h2 id="react">React结构入门</h2>
<p>以上面的代码为例。Java从接触的时候的1.5发展到了1.8，多了很多并行运算、模板、闭包、线程安全等新特性，Python也不是一成不变，JavaScript也发展到了es6，es7正在路上。上面的代码，是基于es6。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 和大部分语音一致，引用依赖包/库，如Java、Python的import，C系列的include等</span>
<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 定义一个React组件</span>
<span class="c1">// 如果做过其他胖客户端的开发的话，类似Android、VB、C#等，extend View</span>
<span class="kr">class</span> <span class="nx">ComponentA</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="p">{</span>
    <span class="c1">// 非常熟悉的面向对象的概念中的构造函数</span>
    <span class="c1">// props即使用ComponentA时传入的初始化参数</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
        <span class="c1">// 设置该组件构造时的状态</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">stateTag</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// 初始化完成开始渲染DOM，React在这里计算需要修改哪些DOM节点并进行更新</span>
    <span class="nx">render</span><span class="p">(){</span>
        <span class="c1">// es6的关键字，不再使用var，var的作用域不好控制</span>
        <span class="c1">// let声明变量，const声明常量</span>
        <span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">stateTag</span><span class="o">?</span> <span class="s1">&#39;这是一个标签&#39;</span><span class="o">:</span><span class="s1">&#39;这不是一个标签&#39;</span>
        <span class="kd">let</span> <span class="nx">arrayInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">elems</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">// forEach为es6中的数组遍历</span>
        <span class="c1">// (param)=&gt;(expression(param))为新的操作符，param为形参，表示对param立刻执行expression(param)</span>
        <span class="c1">// (v,i)是forEach的可变形参列表，可以为1-3个参数，分别是数组项值、下表、数组引用</span>
        <span class="c1">// 都是语法糖，整个含义就是遍历数组，对于每个数组项执行一个操作</span>
        <span class="nx">arrayInfo</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">v</span><span class="p">,</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">elems</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">i</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">}</span> <span class="o">&lt;</span><span class="err">/div&gt;)))</span>
        <span class="c1">// return中写静态页面，HTML。需要注意的主要有三点：</span>
        <span class="c1">// html关键字class修改为className</span>
        <span class="c1">// style通过对象传入，带有“-”的修改为驼峰命名，如style=&quot;padding-top:1rem&quot;修改为style=</span>
        <span class="c1">// 列表需要加入唯一key，如key = {列表名 + 页号 + 下标}</span>
        <span class="k">return</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">elems</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;&lt;/div&gt;)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 使用方式如下，传入一个对象到init属性，在ComponentA中通过this.props.init访问</span>
<span class="o">&lt;</span><span class="nx">ComponentA</span> <span class="nx">init</span><span class="o">=</span> <span class="err">/&gt;</span></code></pre></figure>

<h3 id="section-1">常用声明周期函数</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// render之前调用</span>
<span class="nx">componentWillMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 修改state</span>
<span class="p">}</span>
<span class="c1">// render之后调用</span>
<span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 发送异步请求</span>
<span class="p">}</span>
<span class="c1">// 销毁之前调用</span>
<span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 清理定时器、中断请求等</span>
<span class="p">}</span></code></pre></figure>

<p>更多详情参考<a href="http://www.ruanyifeng.com/blog/2015/03/react.html">阮一峰的React介绍（es5版代码）</a><a href="http://facebook.github.io/react/docs/getting-started.html">或者官网（还是es5）</a></p>

<p><em>注：</em>阮一峰的博客是15年3月写的，部分内容react可能更新后取消了。比如不再使用JSX，拥抱es6。</p>

<h2 id="react-1">像React一样思考</h2>
<p>React中，props和state是很容易混淆的。什么时候使用props？什么时候使用state？哪些需要在组件内部的state进行管理？都是设计到组件设计的问题。</p>

<p>React最佳实践中，将UI组件分为两种：纯展示类组件和业务类组件。其中，纯展示类组件只负责展示，没有自己的state，如：使用宽a高b位置多少的页面空间展示一种来源为xxx的图片。而父组件负责处理组件状态，如由图片、剪头、分页等组成的轮播图组件，负责处理显示哪张图片，点击的回调是什么，什么时候切换图片，是否可以滑动等。</p>

<p>那么，一个基于react的web app可能就是这样：</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">// 入口index.
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>入口<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;...app.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app.js</span>
<span class="kr">class</span> <span class="nx">ComponentA</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1">//  初始化</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 注入子组件进行调用更新父组件状态</span>
    <span class="nx">updateState</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">render</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 许多状态和cases，以判定页面应该显示成什么样，拼装对应的组件，之后填充到页面</span>
        <span class="kd">let</span> <span class="nx">componentArrayA</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">componentArrayA</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">ComponentX</span> <span class="nx">callbackFunction</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">updateState</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="o">&gt;&lt;</span><span class="err">/ComponentX&gt;)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">componentArrayA</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>很快，就会出现几个问题：
1. 浏览器里我复制链接，我可以在新的浏览器里粘贴就可以打开对应页面，如果没有登录跳到登录页，使用react如何做到？
2. 使用react，页面一多，状态的维护难度会不会爆炸？</p>

<p>要解决这些问题，需要引入新的框架。</p>

<h1 id="section-2">相关知识技术</h1>
<p>## <a href="https://github.com/reactjs/react-router">React-router</a>
第一个问题，其实是路由方面的问题。</p>

<p>在以前接触的Java前端网页开发中，我们是通过Spring-MVC来进行一些基础路由设置，然后将路由处理映射到Controller，在Controller中处理请求并返回对应页面。其中，在请求到Controller之前，会通过一些filter进行处理，比如shiro来进行权限验证（登录与否等）。这样就需要引入react-router。</p>

<p>react-router是一个前端路由框架，监听浏览器的url请求，并进行相应的处理。</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;Router</span> <span class="na">history=</span><span class="s">{hashHistory}</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Route</span> <span class="na">path=</span><span class="s">&quot;/&quot;</span> <span class="na">component=</span><span class="s">{Home}</span>
      <span class="na">onEnter=</span><span class="s">{function(){</span>
        <span class="na">document</span><span class="err">.</span><span class="na">getElementById</span><span class="err">(&#39;</span><span class="na">g-header-line</span><span class="err">&#39;).</span><span class="na">style</span><span class="err">.</span><span class="na">height =</span><span class="err"> </span><span class="s">&#39;0px&#39;</span><span class="err">;/*</span><span class="na">Home</span><span class="err">页面需要进行特殊处理*/</span>
        <span class="na">let</span> <span class="na">TRUE =</span><span class="err"> </span><span class="s">true</span>
        <span class="na">pushPageTrace</span><span class="err">(</span><span class="na">TRUE</span><span class="err">,</span> <span class="na">escape</span><span class="err">(&#39;</span><span class="na">http:</span><span class="err">//</span><span class="na">web2native</span><span class="err">|</span><span class="na">channel=</span><span class="s">goto_xhtml*path=login/xhtml/unlogin_menu_location.xhtml&#39;))</span>
      <span class="err">}}</span>
      <span class="na">onLeave=</span><span class="s">{function(){</span>
        <span class="na">let</span> <span class="na">height =</span><span class="err"> </span><span class="s">0;</span>
        <span class="na">let</span> <span class="na">parser =</span><span class="err"> </span><span class="s">new</span> <span class="na">UAParser</span><span class="err">();</span>
        <span class="na">let</span> <span class="na">result =</span><span class="err"> </span><span class="s">parser.getResult();</span>
        <span class="na">if</span> <span class="err">(</span><span class="na">result</span><span class="err">.</span><span class="na">os</span><span class="err">.</span><span class="na">name =</span><span class="s">==</span> <span class="err">&#39;</span><span class="na">iOS</span><span class="err">&#39;)</span> <span class="err">{</span>
          <span class="na">if</span> <span class="err">(</span><span class="na">result</span><span class="err">.</span><span class="na">os</span><span class="err">.</span><span class="na">version</span><span class="err">.</span><span class="na">substr</span><span class="err">(</span><span class="na">0</span><span class="err">,</span> <span class="na">result</span><span class="err">.</span><span class="na">os</span><span class="err">.</span><span class="na">version</span><span class="err">.</span><span class="na">indexOf</span><span class="err">(&#39;.&#39;))</span> <span class="nt">&gt;</span> 6) {
            height = 20 * (document.documentElement.clientWidth / 320);
          }
        }
        document.getElementById(&#39;g-header-line&#39;).style.height = height + &#39;px&#39;;
      }}/&gt;
<span class="nt">&lt;/Router&gt;</span></code></pre></figure>

<p>hashHistory用的是react-router提供的基于浏览器自带history制作的history.js的一个历史记录数据结构，使用的是http://xxx/#/xxx?hash=xxx的形式。</p>

<Route />
<p>标签中path即#/path，component即自己写的react组件，onEnter即进入页面前的处理，可以在此对路由进行预处理，onLeave同理。通过这种方式，能解决前端路由问题。</p>

<h3 id="section-3">题外</h3>
<p>hashHistory的#总是有点奇怪的，表现上有点像把html的锚点重定义了。在现在H5的语义化大环境下，这并不是一个好的解决方案。所以，react-router提供了browserHistory这样传统的解决方案。</p>

<p>在之前的项目中没有使用browserHistory的原因有：
1. 前期调研不充分。
2. 时间紧张，没有时间进行对应改造。</p>

<p>闲暇时间尝试过修改为browserHistory，涉及到了一些代码目录结构修改和路由重定向的问题，还有一些部署优化的问题，暂时没有动手。</p>

<h2 id="reduxhttpreduxjsorg"><a href="http://redux.js.org/">Redux</a></h2>
<p><em>还好我们的应用不是很大，使用react-router拆分后，页面状态没有爆炸，暂时用不到redux。</em></p>

<p>redux是一个状态树管理框架，主要解决的问题就是状态的管理，可以类似理解为一个状态管理中心。不理解可以参考接触的各种注册/提供/消费模式，如Dubbo，在redux中注册，标明谁来更新状态，状态更新后通知谁更新。</p>

<p>暂时只阅读了相关文档没有实际使用，不再赘述。</p>

<h2 id="npmwebpack">npm和webpack及其他</h2>
<p>用之前的项目理解，npm和webpack共同构成了一个maven。</p>

<h3 id="npm">npm</h3>
<p>包管理工具，依赖管理工具，下载包，执行配置命令等。</p>

<h3 id="webpack">webpack</h3>
<p>发布工具，发布前预处理等。</p>

<h3 id="packagejson">package.json</h3>
<p>作用类似pom.xml</p>

<h2 id="section-4">开发工具</h2>
<p>一般就是sublime text和atom，两种都是非常好的编辑器，并且开发es6+react时并没有太多差别，都有相关插件。</p>

<h3 id="sublime-text3">sublime text3</h3>
<p>离线安装插件需要安装PyV8，步骤参考<a href="https://packagecontrol.io/installation">这里</a>。
1. 打开Preferences &gt; Browse Packages。
2. 向上一级，找到Installed Packages/目录，没有则手动创建。
3. 下载<a href="https://packagecontrol.io/Package%20Control.sublime-package">Package Control.sublime-package</a>，复制到Installed Packages/。
4. 重启sublime text3。</p>

<h3 id="atom">atom</h3>
<p>atom可以直接问(度娘)[http://jingyan.baidu.com/article/375c8e19c3105a25f2a22901.html]，初始步骤只有一个：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">npm</span> <span class="nx">install</span> <span class="nx">language</span><span class="o">-</span><span class="nx">asciidoc</span></code></pre></figure>

<h3 id="section-5">相关插件</h3>
<p>离线下载插件包安装地址：<a href="https://packagecontrol.io/">sublime相关</a>，<a href="https://atom.io/packages">atom相关</a>。请阅读英文介绍，使用es6相关的，使用人数较多的插件。</p>

<p>两种编辑器需要的插件基本相同，找关键字，：
- babel：es6语法插件。
- emmet：HTML标签自动补全。
- autocomplete：代码自动补全。
- react snippets：react代码片段。</p>

<p>其他暂时没有想到，可以自行在网站检索。</p>

<p>因为GBK字符集问题，sublime额外需要ConvertToUTF8和Encoding Helper插件。atom没有使用过暂不清楚。</p>

<h1 id="app">和掌银框架、APP使用</h1>
<p>和掌银结合时，主要有两个问题需要解决：
1. 1x、2x和3x缩放和iOS沉浸式webview适配。
2. Android物理返回键处理。</p>

<h2 id="webview">缩放和沉浸式webview适配</h2>
<p>缩放和适配相对比较简单：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">docEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span>
      <span class="nx">resizeEvt</span> <span class="o">=</span> <span class="s1">&#39;orientationchange&#39;</span> <span class="k">in</span> <span class="nb">window</span> <span class="o">?</span> <span class="s1">&#39;orientationchange&#39;</span> <span class="o">:</span> <span class="s1">&#39;resize&#39;</span><span class="p">,</span>
      <span class="nx">recalc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UAParser</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">getResult</span><span class="p">();</span> 
        <span class="kd">var</span> <span class="nx">clientWidth</span> <span class="o">=</span> <span class="nx">docEl</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">clientWidth</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">baseSize</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="p">(</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="mi">320</span><span class="p">)</span>
        <span class="nx">docEl</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">fontSize</span> <span class="o">=</span> <span class="nx">baseSize</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span>
        <span class="c1">// iOS 7以上的都为沉浸式，需要额外的高度</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">os</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;iOS&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">os</span><span class="p">.</span><span class="nx">version</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">os</span><span class="p">.</span><span class="nx">version</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;g-header-line&#39;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">baseSize</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span> 
        
      <span class="p">};</span></code></pre></figure>

<h2 id="android">Android物理返回键处理</h2>
<p>物理返回键比较复杂，原因主要为，需要切换webview。这里不得不说，有些页面，如登录、支付，还是能做成native弹框以便到处调用比较好，那样就不会有这个问题了。</p>

<p><strong>使用webview cookie来实现返回</strong></p>

<p>在该APP中，多个webview之间共享cookie。利用cookie，我们可以实现类似于native的返回。目前使用的技术有：react、react-router、react-cookie。</p>

<p>第一版思路：
1. 各个页面专注自己的业务逻辑，将返回封装到NavBar。
2. 压栈操作放在react-router的onEnter方法中来进行操作。</p>

<p>流程如图：</p>

<p><img src="http://7xogz7.com1.z0.glb.clouddn.com/CookieHistoryBeta1.png" alt="歌王争霸栈v0.0.1" /></p>

<p>代码如下：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 压栈函数</span>
<span class="kd">function</span> <span class="nx">pushPageTrace</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">trace</span> <span class="o">=</span> <span class="nx">Cookie</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">Global</span><span class="p">.</span><span class="nx">PAGE_TRACE</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Cookie</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">Global</span><span class="p">.</span><span class="nx">PAGE_TRACE</span><span class="p">)</span> <span class="o">:</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">()</span>
  <span class="kd">let</span> <span class="nx">storeUrl</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span>
  <span class="nx">trace</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">storeUrl</span><span class="p">)</span>
  <span class="nx">Cookie</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">Global</span><span class="p">.</span><span class="nx">PAGE_TRACE</span><span class="p">,</span> <span class="nx">trace</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// 压栈</span>
<span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;route&#39;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">Com</span><span class="p">}</span> <span class="nx">onEnter</span><span class="o">=</span><span class="p">{</span><span class="kd">function</span><span class="p">(){</span><span class="nx">pushPageTrace</span><span class="p">()}}</span><span class="o">/&gt;</span>
<span class="c1">// 返回按钮</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">NavBar</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">goBack</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">pageTrace</span> <span class="o">=</span> <span class="nx">Cookie</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">Global</span><span class="p">.</span><span class="nx">PAGE_TRACE</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">backUrl</span>
        <span class="nx">pageTrace</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
        <span class="nx">backUrl</span> <span class="o">=</span> <span class="nx">pageTrace</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
        <span class="nx">Cookie</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">Global</span><span class="p">.</span><span class="nx">PAGE_TRACE</span><span class="p">,</span> <span class="nx">pageTrace</span><span class="p">)</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">backUrl</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>在实际使用的过程中，有几个问题：
1. 需要有个时机来清空栈。
2. 部分页面需要设置特殊的返回页面，如支付结果页面不再回到支付订单详情确认页面而是回到商品信息页面。
3. 对栈底需要进行特殊处理，不能空栈。</p>

<p>修改如下：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 压栈函数</span>
<span class="kd">function</span> <span class="nx">pushPageTrace</span><span class="p">(</span><span class="nx">clear</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">specialUrl</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">trace</span> <span class="o">=</span> <span class="nx">clear</span> <span class="o">?</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">()</span> <span class="o">:</span> <span class="nx">Cookie</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">Global</span><span class="p">.</span><span class="nx">PAGE_TRACE</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Cookie</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">Global</span><span class="p">.</span><span class="nx">PAGE_TRACE</span><span class="p">)</span> <span class="o">:</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">()</span>
  <span class="kd">let</span> <span class="nx">storeUrl</span> <span class="o">=</span> <span class="nx">specialUrl</span> <span class="o">?</span> <span class="nx">specialUrl</span> <span class="o">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span>
  <span class="nx">trace</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">storeUrl</span><span class="p">)</span>
  <span class="nx">Cookie</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">Global</span><span class="p">.</span><span class="nx">PAGE_TRACE</span><span class="p">,</span> <span class="nx">trace</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// 返回按钮</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">NavBar</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">goBack</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">clicked</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
                <span class="nx">clicked</span><span class="o">:</span> <span class="kc">true</span>
            <span class="p">})</span>
            <span class="kd">let</span> <span class="nx">pageTrace</span> <span class="o">=</span> <span class="nx">Cookie</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">Global</span><span class="p">.</span><span class="nx">PAGE_TRACE</span><span class="p">)</span>
            <span class="kd">let</span> <span class="nx">backUrl</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">pageTrace</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">backUrl</span> <span class="o">=</span> <span class="nx">pageTrace</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">pageTrace</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">pageTrace</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
                <span class="nx">backUrl</span> <span class="o">=</span> <span class="nx">pageTrace</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">pageTrace</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
                <span class="nx">backUrl</span> <span class="o">=</span> <span class="nx">pageTrace</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="nx">Cookie</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">Global</span><span class="p">.</span><span class="nx">PAGE_TRACE</span><span class="p">,</span> <span class="nx">pageTrace</span><span class="p">)</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">backUrl</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h1 id="todo">TODO</h1>
<ul>
  <li>如何使用browserHistory。</li>
  <li>使用Redux。</li>
  <li>制作自己的组件库，支持自定义样式。</li>
  <li>css压缩优化。</li>
  <li>scss和less。</li>
  <li>淘宝在移动端和chrome等使用webp，在其他端使用jpeg和png，如何做到。</li>
  <li>Controller层session和shiro/JWT与前端路由的使用。</li>
  <li>使用webpack插件做到如maven的各个环境独立配置，文本替换，加入js等文件的hash值。</li>
</ul>

              <footer>
                <ul class="stats">
                
        <!--
        <li><a href="#">General</a></li>
        <li><a href="#" class="icon fa-heart">28</a></li>
        <li><a href="#" class="icon fa-comment">128</a></li>
        -->
                </ul>
              </footer>
           </article>
  					<ul class="actions pagination">
  					  
  	  				  <li><a href="/2016/05/19/hybird%E6%A8%A1%E5%BC%8F%E4%B8%8Bwebview%E4%B8%AD%E7%9A%84%E7%89%A9%E7%90%86%E8%BF%94%E5%9B%9E%E9%94%AE%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95.html" class="button big previous">Previous Post</a></li>
  						
							
  						  <li><a href="/web/2016/06/22/%E9%98%B6%E6%AE%B5%E6%80%A7%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E9%A1%B9%E7%9B%AE%E5%BE%85%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93.html" class="button big next">Next Post</a></li>
  						
  					</ul>
					</div>

				<!-- Sidebar -->
					<section id="sidebar">

						<!-- Intro -->
						<section id="intro">
  <a href="http://techctu.github.io/" class="logo"><img src="/images/logo.jpg" alt="" /></a>
	<header>
    <h2>Avalon</h2>
		<p>反正不要钱 多少写一点
    </p>
	</header>
</section>


						<!-- Mini Posts -->
						<section>
  <div class="mini-posts">
    
      <article class="mini-post">
  	    <header>
  		    <h3><a href="/2016/07/31/react-router%E4%BB%8Ehashhistory%E5%88%B0browserhistory.html">react-router：从hashHistory到browserHistory</a></h3>
		      <time class="published" datetime="2016-07-31">July 31, 2016</time>
						<!--<a href="#" class="author"><img src="/images/avatar.jpg" alt="" /></a>-->
			  </header>
        
		  </article>
									<!-- Mini Post -->
									  <!--
										<article class="mini-post">
											<header>
												<h3><a href="#">Vitae sed condimentum</a></h3>
												<time class="published" datetime="2015-10-20">October 20, 2015</time>
												<a href="#" class="author"><img src="/images/avatar.jpg" alt="" /></a>
											</header>
											<a href="#" class="image"><img src="/images/pic04.jpg" alt="" /></a>
										</article>
									-->
    
      <article class="mini-post">
  	    <header>
  		    <h3><a href="/2016/07/14/%E5%89%8D%E7%AB%AF%E9%87%8D%E6%9E%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95%E5%90%8E%E6%80%9D%E8%B7%AF%E6%95%B4%E7%90%86.html">前端重构第一次尝试后思路整理</a></h3>
		      <time class="published" datetime="2016-07-14">July 14, 2016</time>
						<!--<a href="#" class="author"><img src="/images/avatar.jpg" alt="" /></a>-->
			  </header>
        
		  </article>
									<!-- Mini Post -->
									  <!--
										<article class="mini-post">
											<header>
												<h3><a href="#">Vitae sed condimentum</a></h3>
												<time class="published" datetime="2015-10-20">October 20, 2015</time>
												<a href="#" class="author"><img src="/images/avatar.jpg" alt="" /></a>
											</header>
											<a href="#" class="image"><img src="/images/pic04.jpg" alt="" /></a>
										</article>
									-->
    
      <article class="mini-post">
  	    <header>
  		    <h3><a href="/2016/07/11/%E5%89%8D%E7%AB%AF%E9%87%8D%E6%9E%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95.html">前端重构第一次尝试</a></h3>
		      <time class="published" datetime="2016-07-11">July 11, 2016</time>
						<!--<a href="#" class="author"><img src="/images/avatar.jpg" alt="" /></a>-->
			  </header>
        
		  </article>
									<!-- Mini Post -->
									  <!--
										<article class="mini-post">
											<header>
												<h3><a href="#">Vitae sed condimentum</a></h3>
												<time class="published" datetime="2015-10-20">October 20, 2015</time>
												<a href="#" class="author"><img src="/images/avatar.jpg" alt="" /></a>
											</header>
											<a href="#" class="image"><img src="/images/pic04.jpg" alt="" /></a>
										</article>
									-->
    
      <article class="mini-post">
  	    <header>
  		    <h3><a href="/2016/07/02/%E4%BD%BF%E7%94%A8esformat%E5%92%8C%E5%85%B6plugin%E6%9D%A5%E6%A0%BC%E5%BC%8F%E5%8C%96es6%E5%8F%8Areact%E4%BB%A3%E7%A0%81.html">使用esformat和其plugin来格式化es6及react代码</a></h3>
		      <time class="published" datetime="2016-07-02">July 02, 2016</time>
						<!--<a href="#" class="author"><img src="/images/avatar.jpg" alt="" /></a>-->
			  </header>
        
		  </article>
									<!-- Mini Post -->
									  <!--
										<article class="mini-post">
											<header>
												<h3><a href="#">Vitae sed condimentum</a></h3>
												<time class="published" datetime="2015-10-20">October 20, 2015</time>
												<a href="#" class="author"><img src="/images/avatar.jpg" alt="" /></a>
											</header>
											<a href="#" class="image"><img src="/images/pic04.jpg" alt="" /></a>
										</article>
									-->
    
  </div>
</section>


						<!-- Posts List -->

						<!-- About -->
					  <section class="blurb">
	<p>抱朴 守拙
</p>
</section>


						<!-- Footer -->
						<section id="footer">
  <ul class="icons">
		<li><a href="https://github.com/techctu" class="fa-github"><span class="label">GitHub</span></a></li>
		<li><a href="/feed.xml" class="fa-rss"><span class="label">RSS</span></a></li>
		<li><a href="mailto:unlitechc@yahoo.com" class="fa-envelope"><span class="label">Email</span></a></li>
	</ul>
  <p class="copyright">Copyright &copy; 2015 techctu</p>
</section>

					</section>
			</div>
		<!-- Scripts -->
		<script src="/js/jquery.min.js"></script>
<script src="/js/skel.min.js"></script>
<script src="/js/util.js"></script>
<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
<script src="/js/main.js"></script>

	</body>
</html>
